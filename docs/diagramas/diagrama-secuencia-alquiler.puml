@startuml
skinparam style strictuml
skinparam sequenceMessageAlign center

actor Cliente
participant "Interfaz\n(Web/App)" as UI
participant "Sistema\nBiblioteca" as Sistema
database "Base de Datos" as BD

title Diagrama de Secuencia: Proceso de Alquiler

Cliente -> UI : Seleccionar libro
UI -> Sistema : solicitarDisponibilidad(libroId)

activate Sistema
Sistema -> BD : consultarEjemplaresDisponibles(libroId)
activate BD
BD --> Sistema : listaEjemplares
deactivate BD

alt #LightGreen Ejemplar disponible
    Cliente -> UI : Confirmar alquiler
    UI -> Sistema : registrarAlquiler(copyId, userId)

    group Transacción ACID
        Sistema -> BD : BEGIN TRANSACTION
        Sistema -> BD : INSERT INTO Rental
        Sistema -> BD : UPDATE BookCopy SET Status = 'Prestado'
        Sistema -> BD : COMMIT
    end

    Sistema --> UI : Alquiler confirmado
    UI --> Cliente : Mostrar confirmación y Ticket
else #Pink No hay ejemplares
    Sistema --> UI : Libro no disponible
    UI --> Cliente : Mostrar mensaje "Agotado"
end
deactivate Sistema

note right of BD : El estado cambia de\n'Disponible' a 'Prestado'

@enduml
