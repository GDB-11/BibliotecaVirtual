<!DOCTYPE html>
<html lang="es" 
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{admin/layout}">
<head>
    <title>Libros Más Pedidos</title>
    <th:block layout:fragment="extra-css">
        <style>
            .rank-1 { background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%); color: white; }
            .rank-2 { background: linear-gradient(135deg, #94a3b8 0%, #64748b 100%); color: white; }
            .rank-3 { background: linear-gradient(135deg, #c084fc 0%, #a855f7 100%); color: white; }
            .progress { height: 25px; }
        </style>
    </th:block>
</head>
<body>
    <div layout:fragment="content">
        <!-- Page Header -->
        <div class="content-header">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h2 class="mb-0"><i class="bi bi-bar-chart-line me-2"></i>Libros Más Pedidos</h2>
                    <p class="text-muted mb-0">Estadísticas de los libros con mayor demanda</p>
                </div>
                <div>
                    <div class="btn-group">
                        <a th:href="@{/admin/reportes/libros-pedidos(limite=5)}" class="btn btn-outline-primary">Top 5</a>
                        <a th:href="@{/admin/reportes/libros-pedidos(limite=10)}" class="btn btn-outline-primary">Top 10</a>
                        <a th:href="@{/admin/reportes/libros-pedidos(limite=20)}" class="btn btn-outline-primary">Top 20</a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Charts Section (opcional, puedes agregar gráficos después) -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header bg-primary text-white">
                        <h6 class="mb-0"><i class="bi bi-pie-chart me-2"></i>Distribución de Alquileres</h6>
                    </div>
                    <div class="card-body text-center py-4">
                        <p class="text-muted mb-0">Gráfico de distribución - Próximamente</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Top Books Table -->
        <div class="card">
            <div class="card-header bg-success text-white">
                <h5 class="mb-0"><i class="bi bi-trophy me-2"></i>Top <span th:text="${limite}">10</span> Libros Más Solicitados</h5>
            </div>
            <div class="card-body">
                <div th:if="${#lists.isEmpty(topLibros)}" class="text-center py-5">
                    <i class="bi bi-inbox fs-1 text-muted"></i>
                    <p class="text-muted mt-3">No hay datos suficientes</p>
                </div>

                <div th:unless="${#lists.isEmpty(topLibros)}" class="table-responsive">
                    <table class="table table-hover align-middle">
                        <thead class="table-light">
                            <tr>
                                <th>#</th>
                                <th>Libro</th>
                                <th>Autor</th>
                                <th>Total Alquileres</th>
                                <th>Porcentaje</th>
                                <th>Activos</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr th:each="book, stat : ${topLibros}">
                                <td>
                                    <div th:if="${stat.index == 0}" class="rank-1 rounded-circle text-center" 
                                         style="width: 40px; height: 40px; line-height: 40px;">
                                        <strong th:text="${stat.index + 1}">1</strong>
                                    </div>
                                    <div th:if="${stat.index == 1}" class="rank-2 rounded-circle text-center"
                                         style="width: 40px; height: 40px; line-height: 40px;">
                                        <strong th:text="${stat.index + 1}">2</strong>
                                    </div>
                                    <div th:if="${stat.index == 2}" class="rank-3 rounded-circle text-center"
                                         style="width: 40px; height: 40px; line-height: 40px;">
                                        <strong th:text="${stat.index + 1}">3</strong>
                                    </div>
                                    <div th:if="${stat.index > 2}" class="bg-secondary text-white rounded-circle text-center"
                                         style="width: 40px; height: 40px; line-height: 40px;">
                                        <strong th:text="${stat.index + 1}">4</strong>
                                    </div>
                                </td>
                                <td>
                                    <strong th:text="${book.title}">Nombre del libro</strong>
                                </td>
                                <td th:text="${book.authorName}">Nombre del autor</td>
                                <td>
                                    <span class="badge bg-primary fs-6" th:text="${book.rentalCount}">10</span>
                                </td>
                                <td style="width: 200px;">
                                    <div class="progress">
                                        <div class="progress-bar bg-success" 
                                             role="progressbar" 
                                             th:style="'width: ' + ${book.rentalCount * 100 / topLibros[0].rentalCount} + '%'"
                                             th:attr="aria-valuenow=${book.rentalCount * 100 / topLibros[0].rentalCount}, 
                                                      aria-valuemin=0, 
                                                      aria-valuemax=100">
                                            <span th:text="${#numbers.formatDecimal(book.rentalCount * 100 / topLibros[0].rentalCount, 1, 0)} + '%'">100%</span>
                                        </div>
                                    </div>
                                </td>
                                <td>
                                    <span class="badge bg-warning" th:text="${book.activeRentals != null ? book.activeRentals : 0} + ' activos'">0 activos</span>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Total Summary -->
                <div th:unless="${#lists.isEmpty(topLibros)}" class="mt-4 p-3 bg-light rounded">
                    <div class="row">
                        <div class="col-md-6">
                            <small class="text-muted">Total alquileres considerados:</small>
                            <h5 th:text="${#aggregates.sum(topLibros.![rentalCount])}">100</h5>
                        </div>
                        <div class="col-md-6 text-md-end">
                            <small class="text-muted">Promedio por libro:</small>
                            <h5 th:text="${#numbers.formatDecimal(#aggregates.sum(topLibros.![rentalCount]) / #lists.size(topLibros), 1, 1)}">10.5</h5>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
</html>